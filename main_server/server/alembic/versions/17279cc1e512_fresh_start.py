"""fresh start

Revision ID: 17279cc1e512
Revises: 
Create Date: 2025-10-08 05:34:11.531048

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql
import pgvector


# revision identifiers, used by Alembic.
revision: str = '17279cc1e512'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.execute("Create schema if not exists analysis")
    op.execute("Create schema if not exists auth")
    op.execute("Create schema if not exists data_objects")
    op.execute("Create schema if not exists function")
    op.execute("Create schema if not exists orchestrator")
    op.execute("Create schema if not exists model")
    op.execute("Create schema if not exists model_sources")
    op.execute("Create schema if not exists pipeline")
    op.execute("Create schema if not exists project")
    op.execute("Create schema if not exists data_sources")
    op.execute("Create schema if not exists node")
    op.execute("Create schema if not exists plots")
    op.execute("Create schema if not exists runs")
    op.execute("Create schema if not exists tables")

    op.create_table('notebooks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_notebooks')),
    schema='analysis'
    )
    op.create_table('users',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('email', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('disabled', sa.Boolean(), nullable=False),
    sa.Column('hashed_password', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_users')),
    sa.UniqueConstraint('email', name=op.f('uq_users_email')),
    schema='auth'
    )
    op.create_table('feature',
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('unit', sa.String(), nullable=True),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('subtype', sa.String(), nullable=False),
    sa.Column('scale', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('name', name=op.f('pk_feature')),
    schema='data_objects'
    )
    op.create_table('function',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('embedding', pgvector.sqlalchemy.vector.VECTOR(dim=1536), nullable=False),
    sa.Column('implementation_script_path', sa.String(), nullable=False),
    sa.Column('setup_script_path', sa.String(), nullable=True),
    sa.Column('default_args', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("type IN ('inference', 'training', 'computation', 'tool')"),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_function')),
    schema='function'
    )
    op.create_table('chat_context',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_chat_context')),
    schema='orchestrator'
    )
    op.create_table('notebook_sections',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('notebook_id', sa.UUID(), nullable=False),
    sa.Column('section_name', sa.String(), nullable=False),
    sa.Column('section_description', sa.String(), nullable=True),
    sa.Column('next_type', sa.String(), nullable=True),
    sa.Column('next_id', sa.UUID(), nullable=True),
    sa.Column('parent_section_id', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['notebook_id'], ['analysis.notebooks.id'], name=op.f('fk_notebook_sections_notebook_id_notebooks')),
    sa.ForeignKeyConstraint(['parent_section_id'], ['analysis.notebook_sections.id'], name=op.f('fk_notebook_sections_parent_section_id_notebook_sections')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_notebook_sections')),
    schema='analysis'
    )
    op.create_table('user_api_keys',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('key', sa.String(), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_user_api_keys_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_user_api_keys')),
    sa.UniqueConstraint('key', name=op.f('uq_user_api_keys_key')),
    schema='auth'
    )
    op.create_table('dataset',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_dataset_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_dataset')),
    schema='data_objects'
    )
    op.create_table('data_source',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("type IN ('file')"),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_data_source_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_data_source')),
    schema='data_sources'
    )
    op.create_table('function_input_structure',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('function_id', sa.UUID(), nullable=False),
    sa.Column('structure_id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('required', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("structure_id IN ('time_series', 'time_series_aggregation')"),
    sa.ForeignKeyConstraint(['function_id'], ['function.function.id'], name=op.f('fk_function_input_structure_function_id_function')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_function_input_structure')),
    schema='function'
    )
    op.create_table('function_output_structure',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('function_id', sa.UUID(), nullable=False),
    sa.Column('structure_id', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.CheckConstraint("structure_id IN ('time_series', 'time_series_aggregation')"),
    sa.ForeignKeyConstraint(['function_id'], ['function.function.id'], name=op.f('fk_function_output_structure_function_id_function')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_function_output_structure')),
    schema='function'
    )
    op.create_table('function_output_variable',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('function_id', sa.UUID(), nullable=False),
    sa.Column('python_type', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['function_id'], ['function.function.id'], name=op.f('fk_function_output_variable_function_id_function')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_function_output_variable')),
    schema='function'
    )
    op.create_table('model_source',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('public', sa.Boolean(), nullable=False),
    sa.Column('embedding', pgvector.sqlalchemy.vector.VECTOR(dim=1536), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("type IN ('github', 'pypi', 'gitlab', 'huggingface', 'local')"),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_model_source_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_model_source')),
    schema='model_sources'
    )
    op.create_table('pipeline',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_pipeline_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_pipeline')),
    schema='pipeline'
    )
    op.create_table('project',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_project_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_project')),
    schema='project'
    )
    op.create_table('analysis_objects',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('report_generated', sa.Boolean(), nullable=False),
    sa.Column('notebook_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_analysis_objects_project_id_project')),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_analysis_objects_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_objects')),
    schema='analysis'
    )
    op.create_table('analysis_results',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis', sa.String(), nullable=False),
    sa.Column('python_code', sa.String(), nullable=True),
    sa.Column('output_variable', sa.String(), nullable=True),
    sa.Column('input_variable', sa.String(), nullable=True),
    sa.Column('section_id', sa.UUID(), nullable=True),
    sa.Column('next_type', sa.String(), nullable=True),
    sa.Column('next_id', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['section_id'], ['analysis.notebook_sections.id'], name=op.f('fk_analysis_results_section_id_notebook_sections')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_results')),
    schema='analysis'
    )
    op.create_table('dataset_from_data_source',
    sa.Column('data_source_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_dataset_from_data_source_data_source_id_data_source')),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_dataset_from_data_source_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('data_source_id', 'dataset_id', name=op.f('pk_dataset_from_data_source')),
    schema='data_objects'
    )
    op.create_table('dataset_from_dataset',
    sa.Column('source_dataset_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_dataset_from_dataset_dataset_id_dataset')),
    sa.ForeignKeyConstraint(['source_dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_dataset_from_dataset_source_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('source_dataset_id', 'dataset_id', name=op.f('pk_dataset_from_dataset')),
    schema='data_objects'
    )
    op.create_table('dataset_from_pipeline',
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_dataset_from_pipeline_dataset_id_dataset')),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_dataset_from_pipeline_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('pipeline_id', 'dataset_id', name=op.f('pk_dataset_from_pipeline')),
    schema='data_objects'
    )
    op.create_table('object_group',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('original_id_name', sa.String(), nullable=True),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('structure_type', sa.String(), nullable=False),
    sa.Column('save_path', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("structure_type IN ('time_series', 'time_series_aggregation')"),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_object_group_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_object_group')),
    schema='data_objects'
    )
    op.create_table('variable_group',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.Column('save_path', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_variable_group_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_variable_group')),
    schema='data_objects'
    )
    op.create_table('data_source_analysis',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('data_source_id', sa.UUID(), nullable=False),
    sa.Column('content_description', sa.String(), nullable=False),
    sa.Column('quality_description', sa.String(), nullable=False),
    sa.Column('eda_summary', sa.String(), nullable=False),
    sa.Column('cautions', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_data_source_analysis_data_source_id_data_source')),
    sa.ForeignKeyConstraint(['id'], ['data_sources.data_source.id'], name=op.f('fk_data_source_analysis_id_data_source')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_data_source_analysis')),
    schema='data_sources'
    )
    op.create_table('tabular_file_data_source',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('file_name', sa.String(), nullable=False),
    sa.Column('file_path', sa.String(), nullable=False),
    sa.Column('file_type', sa.String(), nullable=False),
    sa.Column('file_size_bytes', sa.BigInteger(), nullable=False),
    sa.Column('num_rows', sa.Integer(), nullable=False),
    sa.Column('num_columns', sa.Integer(), nullable=False),
    sa.Column('content_preview', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['id'], ['data_sources.data_source.id'], name=op.f('fk_tabular_file_data_source_id_data_source')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_tabular_file_data_source')),
    schema='data_sources'
    )
    op.create_table('model',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('embedding', pgvector.sqlalchemy.vector.VECTOR(dim=1536), nullable=False),
    sa.Column('source_id', sa.UUID(), nullable=False),
    sa.Column('owner_id', sa.UUID(), nullable=False),
    sa.Column('public', sa.Boolean(), nullable=False),
    sa.Column('modality', sa.String(), nullable=False),
    sa.Column('default_config', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('programming_language_with_version', sa.String(), nullable=False),
    sa.Column('setup_script_path', sa.String(), nullable=True),
    sa.Column('task', sa.String(), nullable=False),
    sa.Column('inference_function_id', sa.UUID(), nullable=False),
    sa.Column('training_function_id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("modality IN ('time_series', 'tabular', 'multimodal', 'image', 'text', 'audio', 'video')"),
    sa.CheckConstraint("task IN ('forecasting', 'classification', 'regression', 'clustering', 'anomaly_detection', 'generation', 'segmentation')"),
    sa.ForeignKeyConstraint(['inference_function_id'], ['function.function.id'], name=op.f('fk_model_inference_function_id_function')),
    sa.ForeignKeyConstraint(['owner_id'], ['auth.users.id'], name=op.f('fk_model_owner_id_users')),
    sa.ForeignKeyConstraint(['source_id'], ['model_sources.model_source.id'], name=op.f('fk_model_source_id_model_source')),
    sa.ForeignKeyConstraint(['training_function_id'], ['function.function.id'], name=op.f('fk_model_training_function_id_function')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_model')),
    schema='model'
    )
    op.create_table('pypi_model_source',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('package_name', sa.String(), nullable=False),
    sa.Column('package_version', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['id'], ['model_sources.model_source.id'], name=op.f('fk_pypi_model_source_id_model_source')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_pypi_model_source')),
    schema='model_sources'
    )
    op.create_table('node',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('x_position', sa.Float(), nullable=False),
    sa.Column('y_position', sa.Float(), nullable=False),
    sa.Column('type', sa.String(length=255), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_node_project_id_project')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_node')),
    schema='node'
    )
    op.create_table('conversation',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_conversation_project_id_project')),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_conversation_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_conversation')),
    schema='orchestrator'
    )
    op.create_table('data_source_context',
    sa.Column('context_id', sa.UUID(), nullable=False),
    sa.Column('data_source_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['context_id'], ['orchestrator.chat_context.id'], name=op.f('fk_data_source_context_context_id_chat_context')),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_data_source_context_data_source_id_data_source')),
    sa.PrimaryKeyConstraint('context_id', 'data_source_id', name=op.f('pk_data_source_context')),
    schema='orchestrator'
    )
    op.create_table('dataset_context',
    sa.Column('context_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['context_id'], ['orchestrator.chat_context.id'], name=op.f('fk_dataset_context_context_id_chat_context')),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_dataset_context_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('context_id', 'dataset_id', name=op.f('pk_dataset_context')),
    schema='orchestrator'
    )
    op.create_table('pipeline_context',
    sa.Column('context_id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['context_id'], ['orchestrator.chat_context.id'], name=op.f('fk_pipeline_context_context_id_chat_context')),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_pipeline_context_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('context_id', 'pipeline_id', name=op.f('pk_pipeline_context')),
    schema='orchestrator'
    )
    op.create_table('function_in_pipeline',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.Column('function_id', sa.UUID(), nullable=False),
    sa.Column('position', sa.Integer(), nullable=False),
    sa.Column('config', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['function_id'], ['function.function.id'], name=op.f('fk_function_in_pipeline_function_id_function')),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_function_in_pipeline_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_function_in_pipeline')),
    schema='pipeline'
    )
    op.create_table('pipeline_from_dataset',
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_pipeline_from_dataset_dataset_id_dataset')),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_pipeline_from_dataset_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('dataset_id', 'pipeline_id', name=op.f('pk_pipeline_from_dataset')),
    schema='pipeline'
    )
    op.create_table('pipeline_on_event_schedule',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.Column('event_listener_script_path', sa.String(), nullable=False),
    sa.Column('event_description', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_pipeline_on_event_schedule_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_pipeline_on_event_schedule')),
    schema='pipeline'
    )
    op.create_table('pipeline_periodic_schedule',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.Column('start_time', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_time', sa.DateTime(timezone=True), nullable=True),
    sa.Column('schedule_description', sa.String(), nullable=True),
    sa.Column('cron_expression', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_pipeline_periodic_schedule_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_pipeline_periodic_schedule')),
    schema='pipeline'
    )
    op.create_table('pipeline_run',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.Column('status', sa.String(), nullable=False),
    sa.Column('start_time', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_time', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_pipeline_run_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_pipeline_run')),
    schema='pipeline'
    )
    op.create_table('project_data_source',
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('data_source_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_project_data_source_data_source_id_data_source')),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_project_data_source_project_id_project')),
    sa.PrimaryKeyConstraint('project_id', 'data_source_id', name=op.f('pk_project_data_source')),
    schema='project'
    )
    op.create_table('project_dataset',
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_project_dataset_dataset_id_dataset')),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_project_dataset_project_id_project')),
    sa.PrimaryKeyConstraint('project_id', 'dataset_id', name=op.f('pk_project_dataset')),
    schema='project'
    )
    op.create_table('project_pipeline',
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_project_pipeline_pipeline_id_pipeline')),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_project_pipeline_project_id_project')),
    sa.PrimaryKeyConstraint('project_id', 'pipeline_id', name=op.f('pk_project_pipeline')),
    schema='project'
    )
    op.create_table('analysis_objects_datasets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_object_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_object_id'], ['analysis.analysis_objects.id'], name=op.f('fk_analysis_objects_datasets_analysis_object_id_analysis_objects')),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_analysis_objects_datasets_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_objects_datasets')),
    schema='analysis'
    )
    op.create_table('analysis_results_data_sources',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('data_source_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_analysis_results_data_sources_analysis_result_id_analysis_results')),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_analysis_results_data_sources_data_source_id_data_source')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_results_data_sources')),
    schema='analysis'
    )
    op.create_table('analysis_results_datasets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_analysis_results_datasets_analysis_result_id_analysis_results')),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_analysis_results_datasets_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_results_datasets')),
    schema='analysis'
    )
    op.create_table('aggregation_object',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_aggregation_object_analysis_result_id_analysis_results')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_aggregation_object')),
    schema='data_objects'
    )
    op.create_table('data_object',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('group_id', sa.UUID(), nullable=True),
    sa.Column('original_id', sa.String(), nullable=True),
    sa.Column('name', sa.String(), nullable=True),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('additional_variables', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['group_id'], ['data_objects.object_group.id'], name=op.f('fk_data_object_group_id_object_group')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_data_object')),
    schema='data_objects'
    )
    op.create_table('feature_in_group',
    sa.Column('group_id', sa.UUID(), nullable=False),
    sa.Column('feature_name', sa.String(), nullable=False),
    sa.Column('source', sa.String(), nullable=False),
    sa.Column('category_id', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("source IN ('data', 'metadata')"),
    sa.ForeignKeyConstraint(['feature_name'], ['data_objects.feature.name'], name=op.f('fk_feature_in_group_feature_name_feature')),
    sa.ForeignKeyConstraint(['group_id'], ['data_objects.object_group.id'], name=op.f('fk_feature_in_group_group_id_object_group')),
    sa.PrimaryKeyConstraint('group_id', 'feature_name', name=op.f('pk_feature_in_group')),
    schema='data_objects'
    )
    op.create_table('variable',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('variable_group_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('python_type', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['variable_group_id'], ['data_objects.variable_group.id'], name=op.f('fk_variable_variable_group_id_variable_group')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_variable')),
    schema='data_objects'
    )
    op.create_table('feature_in_tabular_file',
    sa.Column('feature_name', sa.String(), nullable=False),
    sa.Column('tabular_file_id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['feature_name'], ['data_objects.feature.name'], name=op.f('fk_feature_in_tabular_file_feature_name_feature')),
    sa.ForeignKeyConstraint(['tabular_file_id'], ['data_sources.tabular_file_data_source.id'], name=op.f('fk_feature_in_tabular_file_tabular_file_id_tabular_file_data_source')),
    sa.PrimaryKeyConstraint('feature_name', 'tabular_file_id', name=op.f('pk_feature_in_tabular_file')),
    schema='data_sources'
    )
    op.create_table('model_entity',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('model_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('weights_save_dir', sa.String(), nullable=True),
    sa.Column('pipeline_id', sa.UUID(), nullable=True),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('config', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['model_id'], ['model.model.id'], name=op.f('fk_model_entity_model_id_model')),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_model_entity_pipeline_id_pipeline')),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_model_entity_project_id_project')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_model_entity')),
    schema='model'
    )
    op.create_table('analysis_node',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis_objects.id'], name=op.f('fk_analysis_node_analysis_id_analysis_objects')),
    sa.ForeignKeyConstraint(['id'], ['node.node.id'], name=op.f('fk_analysis_node_id_node')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_node')),
    schema='node'
    )
    op.create_table('data_source_node',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('data_source_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_data_source_node_data_source_id_data_source')),
    sa.ForeignKeyConstraint(['id'], ['node.node.id'], name=op.f('fk_data_source_node_id_node')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_data_source_node')),
    schema='node'
    )
    op.create_table('dataset_node',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_dataset_node_dataset_id_dataset')),
    sa.ForeignKeyConstraint(['id'], ['node.node.id'], name=op.f('fk_dataset_node_id_node')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_dataset_node')),
    schema='node'
    )
    op.create_table('pipeline_node',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['id'], ['node.node.id'], name=op.f('fk_pipeline_node_id_node')),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_pipeline_node_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_pipeline_node')),
    schema='node'
    )
    op.create_table('analysis_context',
    sa.Column('context_id', sa.UUID(), nullable=False),
    sa.Column('analysis_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis_objects.id'], name=op.f('fk_analysis_context_analysis_id_analysis_objects')),
    sa.ForeignKeyConstraint(['context_id'], ['orchestrator.chat_context.id'], name=op.f('fk_analysis_context_context_id_chat_context')),
    sa.PrimaryKeyConstraint('context_id', 'analysis_id', name=op.f('pk_analysis_context')),
    schema='orchestrator'
    )
    op.create_table('chat_message',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('conversation_id', sa.UUID(), nullable=False),
    sa.Column('role', sa.String(), nullable=False),
    sa.Column('content', sa.String(), nullable=False),
    sa.Column('context_id', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['context_id'], ['orchestrator.chat_context.id'], name=op.f('fk_chat_message_context_id_chat_context')),
    sa.ForeignKeyConstraint(['conversation_id'], ['orchestrator.conversation.id'], name=op.f('fk_chat_message_conversation_id_conversation')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_chat_message')),
    schema='orchestrator'
    )
    op.create_table('chat_pydantic_message',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('conversation_id', sa.UUID(), nullable=False),
    sa.Column('message_list', postgresql.BYTEA(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['conversation_id'], ['orchestrator.conversation.id'], name=op.f('fk_chat_pydantic_message_conversation_id_conversation')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_chat_pydantic_message')),
    schema='orchestrator'
    )
    op.create_table('pipeline_run_object_group_result',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
    sa.Column('object_group_id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['object_group_id'], ['data_objects.object_group.id'], name=op.f('fk_pipeline_run_object_group_result_object_group_id_object_group')),
    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f('fk_pipeline_run_object_group_result_pipeline_run_id_pipeline_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_pipeline_run_object_group_result')),
    schema='pipeline'
    )
    op.create_table('pipeline_run_variables_result',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
    sa.Column('variables_save_path', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f('fk_pipeline_run_variables_result_pipeline_run_id_pipeline_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_pipeline_run_variables_result')),
    schema='pipeline'
    )
    op.create_table('plots',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('plot_config', sa.JSON(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_plots_analysis_result_id_analysis_results')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_plots')),
    schema='plots'
    )
    op.create_table('project_analysis',
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('analysis_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis_objects.id'], name=op.f('fk_project_analysis_analysis_id_analysis_objects')),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_project_analysis_project_id_project')),
    sa.PrimaryKeyConstraint('project_id', 'analysis_id', name=op.f('pk_project_analysis')),
    schema='project'
    )
    op.create_table('run',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('conversation_id', sa.UUID(), nullable=True),
    sa.Column('parent_run_id', sa.UUID(), nullable=True),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=False),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('run_name', sa.String(), nullable=True),
    sa.CheckConstraint("type IN ('data_integration', 'analysis', 'pipeline', 'swe', 'data_source_analysis', 'model_integration')", name='type_check'),
    sa.ForeignKeyConstraint(['conversation_id'], ['orchestrator.conversation.id'], name=op.f('fk_run_conversation_id_conversation')),
    sa.ForeignKeyConstraint(['parent_run_id'], ['runs.run.id'], name=op.f('fk_run_parent_run_id_run')),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_run_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_run')),
    schema='runs'
    )
    op.create_table('tables',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('table_config', sa.JSON(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_tables_analysis_result_id_analysis_results')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_tables')),
    schema='tables'
    )
    op.create_table('analysis_result_runs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_analysis_result_runs_analysis_result_id_analysis_results')),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_analysis_result_runs_run_id_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_result_runs')),
    schema='analysis'
    )
    op.create_table('analysis_status_messages',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('message', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_analysis_status_messages_analysis_result_id_analysis_results')),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_analysis_status_messages_run_id_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_status_messages')),
    schema='analysis'
    )
    op.create_table('time_series',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('num_timestamps', sa.Integer(), nullable=False),
    sa.Column('start_timestamp', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_timestamp', sa.DateTime(timezone=True), nullable=False),
    sa.Column('sampling_frequency', sa.String(), nullable=False),
    sa.Column('timezone', sa.String(), nullable=False),
    sa.ForeignKeyConstraint(['id'], ['data_objects.data_object.id'], name=op.f('fk_time_series_id_data_object')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_time_series')),
    schema='data_objects'
    )
    op.create_table('time_series_aggregation',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('is_multi_series_computation', sa.Boolean(), nullable=False),
    sa.ForeignKeyConstraint(['id'], ['data_objects.data_object.id'], name=op.f('fk_time_series_aggregation_id_data_object')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_time_series_aggregation')),
    schema='data_objects'
    )
    op.create_table('model_entity_node',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('model_entity_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['id'], ['node.node.id'], name=op.f('fk_model_entity_node_id_node')),
    sa.ForeignKeyConstraint(['model_entity_id'], ['model.model_entity.id'], name=op.f('fk_model_entity_node_model_entity_id_model_entity')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_model_entity_node')),
    schema='node'
    )
    op.create_table('model_entity_context',
    sa.Column('context_id', sa.UUID(), nullable=False),
    sa.Column('model_entity_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['context_id'], ['orchestrator.chat_context.id'], name=op.f('fk_model_entity_context_context_id_chat_context')),
    sa.ForeignKeyConstraint(['model_entity_id'], ['model.model_entity.id'], name=op.f('fk_model_entity_context_model_entity_id_model_entity')),
    sa.PrimaryKeyConstraint('context_id', 'model_entity_id', name=op.f('pk_model_entity_context')),
    schema='orchestrator'
    )
    op.create_table('pipeline_from_model_entity',
    sa.Column('model_entity_id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['model_entity_id'], ['model.model_entity.id'], name=op.f('fk_pipeline_from_model_entity_model_entity_id_model_entity')),
    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f('fk_pipeline_from_model_entity_pipeline_id_pipeline')),
    sa.PrimaryKeyConstraint('model_entity_id', 'pipeline_id', name=op.f('pk_pipeline_from_model_entity')),
    schema='pipeline'
    )
    op.create_table('project_model_entity',
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('model_entity_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['model_entity_id'], ['model.model_entity.id'], name=op.f('fk_project_model_entity_model_entity_id_model_entity')),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_project_model_entity_project_id_project')),
    sa.PrimaryKeyConstraint('project_id', 'model_entity_id', name=op.f('pk_project_model_entity')),
    schema='project'
    )
    op.create_table('data_integration_run_input',
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.Column('target_dataset_description', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_data_integration_run_input_run_id_run')),
    sa.PrimaryKeyConstraint('run_id', name=op.f('pk_data_integration_run_input')),
    schema='runs'
    )
    op.create_table('data_integration_run_result',
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.Column('code_explanation', sa.String(), nullable=False),
    sa.Column('python_code_path', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_data_integration_run_result_dataset_id_dataset')),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_data_integration_run_result_run_id_run')),
    sa.PrimaryKeyConstraint('run_id', name=op.f('pk_data_integration_run_result')),
    schema='runs'
    )
    op.create_table('data_source_in_run',
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.Column('data_source_id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_data_source_in_run_data_source_id_data_source')),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_data_source_in_run_run_id_run')),
    sa.PrimaryKeyConstraint('run_id', 'data_source_id', name=op.f('pk_data_source_in_run')),
    schema='runs'
    )
    op.create_table('run_message',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('content', sa.String(), nullable=False),
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.Column('type', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_run_message_run_id_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_run_message')),
    schema='runs'
    )
    op.create_table('run_pydantic_message',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.Column('message_list', postgresql.BYTEA(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_run_pydantic_message_run_id_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_run_pydantic_message')),
    schema='runs'
    )
    op.create_table('time_series_aggregation_input',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('time_series_id', sa.UUID(), nullable=False),
    sa.Column('aggregation_id', sa.UUID(), nullable=False),
    sa.Column('input_feature_name', sa.String(), nullable=False),
    sa.Column('start_timestamp', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_timestamp', sa.DateTime(timezone=True), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint('start_timestamp < end_timestamp'),
    sa.ForeignKeyConstraint(['aggregation_id'], ['data_objects.time_series_aggregation.id'], name=op.f('fk_time_series_aggregation_input_aggregation_id_time_series_aggregation')),
    sa.ForeignKeyConstraint(['id'], ['data_objects.data_object.id'], name=op.f('fk_time_series_aggregation_input_id_data_object')),
    sa.ForeignKeyConstraint(['time_series_id'], ['data_objects.time_series.id'], name=op.f('fk_time_series_aggregation_input_time_series_id_time_series')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_time_series_aggregation_input')),
    schema='data_objects'
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('time_series_aggregation_input', schema='data_objects')
    op.drop_table('run_pydantic_message', schema='runs')
    op.drop_table('run_message', schema='runs')
    op.drop_table('data_source_in_run', schema='runs')
    op.drop_table('data_integration_run_result', schema='runs')
    op.drop_table('data_integration_run_input', schema='runs')
    op.drop_table('project_model_entity', schema='project')
    op.drop_table('pipeline_from_model_entity', schema='pipeline')
    op.drop_table('model_entity_context', schema='orchestrator')
    op.drop_table('model_entity_node', schema='node')
    op.drop_table('time_series_aggregation', schema='data_objects')
    op.drop_table('time_series', schema='data_objects')
    op.drop_table('analysis_status_messages', schema='analysis')
    op.drop_table('analysis_result_runs', schema='analysis')
    op.drop_table('tables', schema='tables')
    op.drop_table('run', schema='runs')
    op.drop_table('project_analysis', schema='project')
    op.drop_table('plots', schema='plots')
    op.drop_table('pipeline_run_variables_result', schema='pipeline')
    op.drop_table('pipeline_run_object_group_result', schema='pipeline')
    op.drop_table('chat_pydantic_message', schema='orchestrator')
    op.drop_table('chat_message', schema='orchestrator')
    op.drop_table('analysis_context', schema='orchestrator')
    op.drop_table('pipeline_node', schema='node')
    op.drop_table('dataset_node', schema='node')
    op.drop_table('data_source_node', schema='node')
    op.drop_table('analysis_node', schema='node')
    op.drop_table('model_entity', schema='model')
    op.drop_table('feature_in_tabular_file', schema='data_sources')
    op.drop_table('variable', schema='data_objects')
    op.drop_table('feature_in_group', schema='data_objects')
    op.drop_table('data_object', schema='data_objects')
    op.drop_table('aggregation_object', schema='data_objects')
    op.drop_table('analysis_results_datasets', schema='analysis')
    op.drop_table('analysis_results_data_sources', schema='analysis')
    op.drop_table('analysis_objects_datasets', schema='analysis')
    op.drop_table('project_pipeline', schema='project')
    op.drop_table('project_dataset', schema='project')
    op.drop_table('project_data_source', schema='project')
    op.drop_table('pipeline_run', schema='pipeline')
    op.drop_table('pipeline_periodic_schedule', schema='pipeline')
    op.drop_table('pipeline_on_event_schedule', schema='pipeline')
    op.drop_table('pipeline_from_dataset', schema='pipeline')
    op.drop_table('function_in_pipeline', schema='pipeline')
    op.drop_table('pipeline_context', schema='orchestrator')
    op.drop_table('dataset_context', schema='orchestrator')
    op.drop_table('data_source_context', schema='orchestrator')
    op.drop_table('conversation', schema='orchestrator')
    op.drop_table('node', schema='node')
    op.drop_table('pypi_model_source', schema='model_sources')
    op.drop_table('model', schema='model')
    op.drop_table('tabular_file_data_source', schema='data_sources')
    op.drop_table('data_source_analysis', schema='data_sources')
    op.drop_table('variable_group', schema='data_objects')
    op.drop_table('object_group', schema='data_objects')
    op.drop_table('dataset_from_pipeline', schema='data_objects')
    op.drop_table('dataset_from_dataset', schema='data_objects')
    op.drop_table('dataset_from_data_source', schema='data_objects')
    op.drop_table('analysis_results', schema='analysis')
    op.drop_table('analysis_objects', schema='analysis')
    op.drop_table('project', schema='project')
    op.drop_table('pipeline', schema='pipeline')
    op.drop_table('model_source', schema='model_sources')
    op.drop_table('function_output_variable', schema='function')
    op.drop_table('function_output_structure', schema='function')
    op.drop_table('function_input_structure', schema='function')
    op.drop_table('data_source', schema='data_sources')
    op.drop_table('dataset', schema='data_objects')
    op.drop_table('user_api_keys', schema='auth')
    op.drop_table('notebook_sections', schema='analysis')
    op.drop_table('chat_context', schema='orchestrator')
    op.drop_table('function', schema='function')
    op.drop_table('feature', schema='data_objects')
    op.drop_table('users', schema='auth')
    op.drop_table('notebooks', schema='analysis')
    
    op.execute("DROP schema if exists tables CASCADE")
    op.execute("DROP schema if exists runs CASCADE")
    op.execute("DROP schema if exists plots CASCADE")
    op.execute("DROP schema if exists node CASCADE")
    op.execute("DROP schema if exists data_sources CASCADE")
    op.execute("DROP schema if exists project CASCADE")
    op.execute("DROP schema if exists pipeline CASCADE")
    op.execute("DROP schema if exists model_sources CASCADE")
    op.execute("DROP schema if exists model CASCADE")
    op.execute("DROP schema if exists orchestrator CASCADE")
    op.execute("DROP schema if exists function CASCADE")
    op.execute("DROP schema if exists data_objects CASCADE")
    op.execute("DROP schema if exists auth CASCADE")
    op.execute("DROP schema if exists analysis CASCADE")
    # ### end Alembic commands ###
