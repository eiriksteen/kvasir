"""Remove unnecessary pipeline models and add pipeline run type

Revision ID: 9518db81eda0
Revises: c1d716cb8ae6
Create Date: 2025-10-01 00:16:19.347403

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '9518db81eda0'
down_revision: Union[str, None] = 'c1d716cb8ae6'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('pipeline_run_variable_group_result', schema='pipeline')
    op.drop_table('pipeline_run_object_group_result', schema='pipeline')

    # Drop old type_check constraint
    op.drop_constraint('type_check', 'run', schema='runs')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    # Revert type_check constraint
    op.drop_constraint('type_check', 'run', schema='runs')
    op.create_check_constraint(
        'type_check',
        'run',
        "type IN ('data_integration', 'analysis', 'pipeline', 'swe', 'data_source_analysis', 'model_integration')",
        schema='runs'
    )

    op.create_table('pipeline_run_object_group_result',
                    sa.Column('id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('object_group_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('output_to_save_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['object_group_id'], ['data_objects.object_group.id'], name=op.f(
                        'pipeline_run_object_group_result_object_group_id_fkey')),
                    sa.ForeignKeyConstraint(['output_to_save_id'], ['pipeline.pipeline_object_group_output_to_save.id'], name=op.f(
                        'pipeline_run_object_group_result_output_to_save_id_fkey')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'pipeline_run_object_group_result_pipeline_run_id_fkey')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pipeline_run_object_group_result_pkey')),
                    schema='pipeline'
                    )
    op.create_table('pipeline_run_variable_group_result',
                    sa.Column('id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('variable_group_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('output_to_save_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['output_to_save_id'], ['pipeline.pipeline_variable_group_output_to_save.id'], name=op.f(
                        'pipeline_run_variable_group_result_output_to_save_id_fkey')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'pipeline_run_variable_group_result_pipeline_run_id_fkey')),
                    sa.ForeignKeyConstraint(['variable_group_id'], ['data_objects.variable_group.id'], name=op.f(
                        'pipeline_run_variable_group_result_variable_group_id_fkey')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pipeline_run_variable_group_result_pkey')),
                    schema='pipeline'
                    )
    # ### end Alembic commands ###
