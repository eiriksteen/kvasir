"""Add analysis in pipeline model

Revision ID: 2735a4df59c9
Revises: ed1510f9d137
Create Date: 2025-10-22 14:07:03.054498

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '2735a4df59c9'
down_revision: Union[str, None] = 'ed1510f9d137'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('analysis_in_pipeline',
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_analysis_in_pipeline_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_analysis_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint(
                        'pipeline_id', 'analysis_id', name=op.f('pk_analysis_in_pipeline')),
                    schema='pipeline'
                    )
    op.drop_table('dataset_from_dataset', schema='data_objects')
    op.drop_table('dataset_from_data_source', schema='data_objects')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('dataset_from_data_source',
                    sa.Column('data_source_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'dataset_from_data_source_data_source_id_fkey')),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'dataset_from_data_source_dataset_id_fkey')),
                    sa.PrimaryKeyConstraint('data_source_id', 'dataset_id', name=op.f(
                        'dataset_from_data_source_pkey')),
                    schema='data_objects'
                    )
    op.create_table('dataset_from_dataset',
                    sa.Column('source_dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'dataset_from_dataset_dataset_id_fkey')),
                    sa.ForeignKeyConstraint(['source_dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'dataset_from_dataset_source_dataset_id_fkey')),
                    sa.PrimaryKeyConstraint(
                        'source_dataset_id', 'dataset_id', name=op.f('dataset_from_dataset_pkey')),
                    schema='data_objects'
                    )
    op.drop_table('analysis_in_pipeline', schema='pipeline')
    # ### end Alembic commands ###
