"""initial migration

Revision ID: 874fa94f6e40
Revises: 
Create Date: 2025-11-21 02:19:08.103717

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '874fa94f6e40'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    # Create vector extension if it doesn't exist
    op.execute("CREATE EXTENSION IF NOT EXISTS vector")
    # Create schemas if they don't exist
    op.execute("CREATE SCHEMA IF NOT EXISTS auth")
    op.execute("CREATE SCHEMA IF NOT EXISTS data_sources")
    op.execute("CREATE SCHEMA IF NOT EXISTS data_objects")
    op.execute("CREATE SCHEMA IF NOT EXISTS analysis")
    op.execute("CREATE SCHEMA IF NOT EXISTS pipeline")
    op.execute("CREATE SCHEMA IF NOT EXISTS model")
    op.execute("CREATE SCHEMA IF NOT EXISTS entity_graph")
    op.execute("CREATE SCHEMA IF NOT EXISTS visualization")
    op.execute("CREATE SCHEMA IF NOT EXISTS project")
    op.execute("CREATE SCHEMA IF NOT EXISTS kvasir_v1")
    op.execute("CREATE SCHEMA IF NOT EXISTS waitlist")

    op.create_table('users',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('email', sa.String(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('affiliation', sa.String(), nullable=False),
                    sa.Column('role', sa.String(), nullable=False),
                    sa.Column('disabled', sa.Boolean(), nullable=False),
                    sa.Column('google_id', sa.String(), nullable=True),
                    sa.Column('hashed_password', sa.String(), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_users')),
                    sa.UniqueConstraint('email', name=op.f('uq_users_email')),
                    sa.UniqueConstraint(
                        'google_id', name=op.f('uq_users_google_id')),
                    schema='auth'
                    )
    op.create_table('entity_node',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('x_position', sa.Float(), nullable=False),
                    sa.Column('y_position', sa.Float(), nullable=False),
                    sa.Column('entity_type', sa.String(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_entity_node')),
                    schema='entity_graph'
                    )
    op.create_table('node_group',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('python_package_name',
                              sa.String(), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_node_group')),
                    schema='entity_graph'
                    )
    op.create_table('model_function',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('docstring', sa.String(), nullable=False),
                    sa.Column('args_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('output_variables_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('default_args', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_model_function')),
                    schema='model'
                    )
    op.create_table('echart',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('chart_script_path',
                              sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_echart')),
                    schema='visualization'
                    )
    op.create_table('image',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('image_path', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_image')),
                    schema='visualization'
                    )
    op.create_table('table',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('table_path', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_table')),
                    schema='visualization'
                    )
    op.create_table('waitlist',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('email', sa.String(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('affiliation', sa.String(), nullable=False),
                    sa.Column('role', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_waitlist')),
                    sa.UniqueConstraint(
                        'email', name=op.f('uq_waitlist_email')),
                    schema='waitlist'
                    )
    op.create_table('analysis',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(
                        ['user_id'], ['auth.users.id'], name=op.f('fk_analysis_user_id_users')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis')),
                    schema='analysis'
                    )
    op.create_table('user_api_keys',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('key', sa.String(), nullable=False),
                    sa.Column('expires_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=True),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=True),
                    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f(
                        'fk_user_api_keys_user_id_users')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_user_api_keys')),
                    sa.UniqueConstraint(
                        'key', name=op.f('uq_user_api_keys_key')),
                    schema='auth'
                    )
    op.create_table('dataset',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('description', sa.String(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('additional_variables', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(
                        ['user_id'], ['auth.users.id'], name=op.f('fk_dataset_user_id_users')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_dataset')),
                    schema='data_objects'
                    )
    op.create_table('data_source',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('type', sa.String(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('additional_variables', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f(
                        'fk_data_source_user_id_users')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_data_source')),
                    schema='data_sources'
                    )
    op.create_table('node_in_group',
                    sa.Column('node_id', sa.UUID(), nullable=False),
                    sa.Column('node_group_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['node_group_id'], ['entity_graph.node_group.id'], name=op.f(
                        'fk_node_in_group_node_group_id_node_group')),
                    sa.ForeignKeyConstraint(['node_id'], ['entity_graph.entity_node.id'], name=op.f(
                        'fk_node_in_group_node_id_entity_node')),
                    sa.PrimaryKeyConstraint(
                        'node_id', 'node_group_id', name=op.f('pk_node_in_group')),
                    schema='entity_graph'
                    )
    op.create_table('run',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('project_id', sa.UUID(), nullable=True),
                    sa.Column('run_name', sa.String(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('configuration_defaults_description',
                              sa.String(), nullable=True),
                    sa.Column('type', sa.String(), nullable=False),
                    sa.Column('status', sa.String(), nullable=False),
                    sa.Column('started_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('completed_at', sa.DateTime(
                        timezone=True), nullable=True),
                    sa.ForeignKeyConstraint(
                        ['user_id'], ['auth.users.id'], name=op.f('fk_run_user_id_users')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_run')),
                    schema='kvasir_v1'
                    )
    op.create_table('model',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('description', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(
                        ['user_id'], ['auth.users.id'], name=op.f('fk_model_user_id_users')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_model')),
                    schema='model'
                    )
    op.create_table('pipeline',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(
                        ['user_id'], ['auth.users.id'], name=op.f('fk_pipeline_user_id_users')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_pipeline')),
                    schema='pipeline'
                    )
    op.create_table('project',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('view_port_x', sa.Float(), nullable=False),
                    sa.Column('view_port_y', sa.Float(), nullable=False),
                    sa.Column('view_port_zoom', sa.Float(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(
                        ['user_id'], ['auth.users.id'], name=op.f('fk_project_user_id_users')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_project')),
                    schema='project'
                    )
    op.create_table('analysis_section',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('order', sa.Integer(), nullable=False),
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_analysis_section_analysis_id_analysis')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_analysis_section')),
                    schema='analysis'
                    )
    op.create_table('object_group',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('original_id_name', sa.String(), nullable=True),
                    sa.Column('description', sa.String(), nullable=False),
                    sa.Column('modality', sa.String(), nullable=False),
                    sa.Column('echart_id', sa.UUID(), nullable=True),
                    sa.Column('additional_variables', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_object_group_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['echart_id'], ['visualization.echart.id'], name=op.f(
                        'fk_object_group_echart_id_echart')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_object_group')),
                    schema='data_objects'
                    )
    op.create_table('file_data_source',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('file_name', sa.String(), nullable=False),
                    sa.Column('file_path', sa.String(), nullable=False),
                    sa.Column('file_type', sa.String(), nullable=False),
                    sa.Column('file_size_bytes',
                              sa.BigInteger(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_file_data_source_id_data_source')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_file_data_source')),
                    schema='data_sources'
                    )
    op.create_table('data_source_in_analysis',
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_data_source_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_in_analysis_data_source_id_data_source')),
                    sa.PrimaryKeyConstraint('analysis_id', 'data_source_id', name=op.f(
                        'pk_data_source_in_analysis')),
                    schema='entity_graph'
                    )
    op.create_table('data_source_supported_in_pipeline',
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_supported_in_pipeline_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_data_source_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('data_source_id', 'pipeline_id', name=op.f(
                        'pk_data_source_supported_in_pipeline')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_from_data_source',
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_dataset_from_data_source_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_from_data_source_dataset_id_dataset')),
                    sa.PrimaryKeyConstraint('data_source_id', 'dataset_id', name=op.f(
                        'pk_dataset_from_data_source')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_in_analysis',
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_dataset_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_in_analysis_dataset_id_dataset')),
                    sa.PrimaryKeyConstraint(
                        'analysis_id', 'dataset_id', name=op.f('pk_dataset_in_analysis')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_supported_in_pipeline',
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_supported_in_pipeline_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_dataset_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('dataset_id', 'pipeline_id', name=op.f(
                        'pk_dataset_supported_in_pipeline')),
                    schema='entity_graph'
                    )
    op.create_table('analysis_run',
                    sa.Column('run_id', sa.UUID(), nullable=False),
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('kvasir_run_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_analysis_run_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['kvasir_run_id'], ['kvasir_v1.run.id'], name=op.f(
                        'fk_analysis_run_kvasir_run_id_run')),
                    sa.ForeignKeyConstraint(['run_id'], ['kvasir_v1.run.id'], name=op.f(
                        'fk_analysis_run_run_id_run')),
                    sa.PrimaryKeyConstraint('run_id', 'analysis_id',
                                            'kvasir_run_id', name=op.f('pk_analysis_run')),
                    schema='kvasir_v1'
                    )
    op.create_table('message',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('content', sa.String(), nullable=False),
                    sa.Column('run_id', sa.UUID(), nullable=False),
                    sa.Column('role', sa.String(), nullable=False),
                    sa.Column('type', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(
                        ['run_id'], ['kvasir_v1.run.id'], name=op.f('fk_message_run_id_run')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_message')),
                    schema='kvasir_v1'
                    )
    op.create_table('pydantic_ai_message',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('run_id', sa.UUID(), nullable=False),
                    sa.Column('message_list', postgresql.BYTEA(),
                              nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['run_id'], ['kvasir_v1.run.id'], name=op.f(
                        'fk_pydantic_ai_message_run_id_run')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_pydantic_ai_message')),
                    schema='kvasir_v1'
                    )
    op.create_table('result',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('run_id', sa.UUID(), nullable=False),
                    sa.Column('type', sa.String(), nullable=False),
                    sa.Column('content', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(
                        ['run_id'], ['kvasir_v1.run.id'], name=op.f('fk_result_run_id_run')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_result')),
                    schema='kvasir_v1'
                    )
    op.create_table('results_queue',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('run_id', sa.UUID(), nullable=False),
                    sa.Column('content', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['run_id'], ['kvasir_v1.run.id'], name=op.f(
                        'fk_results_queue_run_id_run')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_results_queue')),
                    schema='kvasir_v1'
                    )
    op.create_table('swe_deps',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('run_id', sa.UUID(), nullable=False),
                    sa.Column('type', sa.String(), nullable=False),
                    sa.Column('content', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(
                        ['run_id'], ['kvasir_v1.run.id'], name=op.f('fk_swe_deps_run_id_run')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_swe_deps')),
                    schema='kvasir_v1'
                    )
    op.create_table('swe_run',
                    sa.Column('run_id', sa.UUID(), nullable=False),
                    sa.Column('kvasir_run_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['kvasir_run_id'], ['kvasir_v1.run.id'], name=op.f(
                        'fk_swe_run_kvasir_run_id_run')),
                    sa.ForeignKeyConstraint(
                        ['run_id'], ['kvasir_v1.run.id'], name=op.f('fk_swe_run_run_id_run')),
                    sa.PrimaryKeyConstraint(
                        'run_id', 'kvasir_run_id', name=op.f('pk_swe_run')),
                    schema='kvasir_v1'
                    )
    op.create_table('model_implementation',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('modality', sa.String(), nullable=False),
                    sa.Column('task', sa.String(), nullable=False),
                    sa.Column('public', sa.Boolean(), nullable=False),
                    sa.Column('python_class_name',
                              sa.String(), nullable=False),
                    sa.Column('description', sa.String(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('source', sa.String(), nullable=False),
                    sa.Column('implementation_script_path',
                              sa.String(), nullable=False),
                    sa.Column('model_class_docstring',
                              sa.String(), nullable=False),
                    sa.Column('default_config', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('config_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('training_function_id',
                              sa.UUID(), nullable=False),
                    sa.Column('inference_function_id',
                              sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.CheckConstraint(
                        "modality IN ('time_series', 'tabular', 'multimodal', 'image', 'text', 'audio', 'video')"),
                    sa.CheckConstraint("source IN ('github', 'pypi')"),
                    sa.CheckConstraint(
                        "task IN ('forecasting', 'classification', 'regression', 'clustering', 'anomaly_detection', 'generation', 'segmentation')"),
                    sa.ForeignKeyConstraint(['id'], ['model.model.id'], name=op.f(
                        'fk_model_implementation_id_model')),
                    sa.ForeignKeyConstraint(['inference_function_id'], ['model.model_function.id'], name=op.f(
                        'fk_model_implementation_inference_function_id_model_function')),
                    sa.ForeignKeyConstraint(['training_function_id'], ['model.model_function.id'], name=op.f(
                        'fk_model_implementation_training_function_id_model_function')),
                    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f(
                        'fk_model_implementation_user_id_users')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_model_implementation')),
                    schema='model'
                    )
    op.create_table('model_instantiated',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('model_id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('description', sa.String(), nullable=False),
                    sa.Column('config', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('weights_save_dir', sa.String(), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['model_id'], ['model.model.id'], name=op.f(
                        'fk_model_instantiated_model_id_model')),
                    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f(
                        'fk_model_instantiated_user_id_users')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_model_instantiated')),
                    schema='model'
                    )
    op.create_table('pipeline_implementation',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('python_function_name',
                              sa.String(), nullable=False),
                    sa.Column('docstring', sa.String(), nullable=False),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('args_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('default_args', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('output_variables_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('implementation_script_path',
                              sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_pipeline_implementation_id_pipeline')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pk_pipeline_implementation')),
                    schema='pipeline'
                    )
    op.create_table('pipeline_run',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('name', sa.String(), nullable=True),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('status', sa.String(), nullable=False),
                    sa.Column('args', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=True),
                    sa.Column('output_variables', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=True),
                    sa.Column('start_time', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('end_time', sa.DateTime(
                        timezone=True), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_pipeline_run_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_pipeline_run')),
                    schema='pipeline'
                    )
    op.create_table('analysis_cell',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('order', sa.Integer(), nullable=False),
                    sa.Column('type', sa.String(), nullable=False),
                    sa.Column('section_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.CheckConstraint("type IN ('markdown', 'code')",
                                       name='analysis_cell_type_check'),
                    sa.ForeignKeyConstraint(['section_id'], ['analysis.analysis_section.id'], name=op.f(
                        'fk_analysis_cell_section_id_analysis_section')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_analysis_cell')),
                    schema='analysis'
                    )
    op.create_table('data_object',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('group_id', sa.UUID(), nullable=True),
                    sa.Column('original_id', sa.String(), nullable=True),
                    sa.Column('name', sa.String(), nullable=True),
                    sa.Column('description', sa.String(), nullable=True),
                    sa.Column('additional_variables', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['group_id'], ['data_objects.object_group.id'], name=op.f(
                        'fk_data_object_group_id_object_group')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_data_object')),
                    schema='data_objects'
                    )
    op.create_table('tabular_group',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('number_of_entities',
                              sa.Integer(), nullable=False),
                    sa.Column('number_of_features',
                              sa.Integer(), nullable=False),
                    sa.Column('features_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=True),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['data_objects.object_group.id'], name=op.f(
                        'fk_tabular_group_id_object_group')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_tabular_group')),
                    schema='data_objects'
                    )
    op.create_table('time_series_group',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('total_timestamps',
                              sa.Integer(), nullable=False),
                    sa.Column('number_of_series',
                              sa.Integer(), nullable=False),
                    sa.Column('sampling_frequency',
                              sa.String(), nullable=True),
                    sa.Column('timezone', sa.String(), nullable=True),
                    sa.Column('features_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=True),
                    sa.Column('earliest_timestamp', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('latest_timestamp', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['data_objects.object_group.id'], name=op.f(
                        'fk_time_series_group_id_object_group')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_time_series_group')),
                    schema='data_objects'
                    )
    op.create_table('data_source_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_in_pipeline_run_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_data_source_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'data_source_id', name=op.f(
                        'pk_data_source_in_pipeline_run')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_in_pipeline_run_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_dataset_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'dataset_id', name=op.f(
                        'pk_dataset_in_pipeline_run')),
                    schema='entity_graph'
                    )
    op.create_table('model_instantiated_in_analysis',
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('model_instantiated_id',
                              sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_model_instantiated_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_instantiated_in_analysis_model_instantiated_id_model_instantiated')),
                    sa.PrimaryKeyConstraint('analysis_id', 'model_instantiated_id', name=op.f(
                        'pk_model_instantiated_in_analysis')),
                    schema='entity_graph'
                    )
    op.create_table('model_instantiated_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('model_instantiated_id',
                              sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_instantiated_in_pipeline_run_model_instantiated_id_model_instantiated')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_model_instantiated_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'model_instantiated_id', name=op.f(
                        'pk_model_instantiated_in_pipeline_run')),
                    schema='entity_graph'
                    )
    op.create_table('model_instantiated_supported_in_pipeline',
                    sa.Column('model_instantiated_id',
                              sa.UUID(), nullable=False),
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_instantiated_supported_in_pipeline_model_instantiated_id_model_instantiated')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_model_instantiated_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('model_instantiated_id', 'pipeline_id', name=op.f(
                        'pk_model_instantiated_supported_in_pipeline')),
                    schema='entity_graph'
                    )
    op.create_table('pipeline_run_output_data_source',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_pipeline_run_output_data_source_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_data_source_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'data_source_id', name=op.f(
                        'pk_pipeline_run_output_data_source')),
                    sa.UniqueConstraint(
                        'data_source_id', name='uq_pipeline_run_output_data_source_data_source_id'),
                    schema='entity_graph'
                    )
    op.create_table('pipeline_run_output_dataset',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_pipeline_run_output_dataset_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_dataset_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'dataset_id', name=op.f(
                        'pk_pipeline_run_output_dataset')),
                    sa.UniqueConstraint(
                        'dataset_id', name='uq_pipeline_run_output_dataset_dataset_id'),
                    schema='entity_graph'
                    )
    op.create_table('pipeline_run_output_model_entity',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('model_instantiated_id',
                              sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_pipeline_run_output_model_entity_model_instantiated_id_model_instantiated')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_model_entity_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'model_instantiated_id', name=op.f(
                        'pk_pipeline_run_output_model_entity')),
                    sa.UniqueConstraint('model_instantiated_id',
                                        name='uq_pipeline_run_output_model_entity_model_entity_id'),
                    schema='entity_graph'
                    )
    op.create_table('code_cell',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('code', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['analysis.analysis_cell.id'], name=op.f(
                        'fk_code_cell_id_analysis_cell')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_code_cell')),
                    schema='analysis'
                    )
    op.create_table('markdown_cell',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('markdown', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['analysis.analysis_cell.id'], name=op.f(
                        'fk_markdown_cell_id_analysis_cell')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_markdown_cell')),
                    schema='analysis'
                    )
    op.create_table('tabular',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('features_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['data_objects.data_object.id'], name=op.f(
                        'fk_tabular_id_data_object')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_tabular')),
                    schema='data_objects'
                    )
    op.create_table('time_series',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('num_timestamps', sa.Integer(), nullable=False),
                    sa.Column('start_timestamp', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('end_timestamp', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('sampling_frequency',
                              sa.String(), nullable=False),
                    sa.Column('timezone', sa.String(), nullable=True),
                    sa.Column('features_schema', postgresql.JSONB(
                        astext_type=sa.Text()), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['data_objects.data_object.id'], name=op.f(
                        'fk_time_series_id_data_object')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_time_series')),
                    schema='data_objects'
                    )
    op.create_table('code_output',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('output', sa.String(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['id'], ['analysis.code_cell.id'], name=op.f(
                        'fk_code_output_id_code_cell')),
                    sa.PrimaryKeyConstraint('id', name=op.f('pk_code_output')),
                    schema='analysis'
                    )
    op.create_table('result_echart',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('code_cell_id', sa.UUID(), nullable=False),
                    sa.Column('echart_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['code_cell_id'], ['analysis.code_cell.id'], name=op.f(
                        'fk_result_echart_code_cell_id_code_cell')),
                    sa.ForeignKeyConstraint(['echart_id'], ['visualization.echart.id'], name=op.f(
                        'fk_result_echart_echart_id_echart')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_result_echart')),
                    schema='analysis'
                    )
    op.create_table('result_image',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('code_cell_id', sa.UUID(), nullable=False),
                    sa.Column('image_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['code_cell_id'], ['analysis.code_cell.id'], name=op.f(
                        'fk_result_image_code_cell_id_code_cell')),
                    sa.ForeignKeyConstraint(['image_id'], ['visualization.image.id'], name=op.f(
                        'fk_result_image_image_id_image')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_result_image')),
                    schema='analysis'
                    )
    op.create_table('result_table',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('code_cell_id', sa.UUID(), nullable=False),
                    sa.Column('table_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['code_cell_id'], ['analysis.code_cell.id'], name=op.f(
                        'fk_result_table_code_cell_id_code_cell')),
                    sa.ForeignKeyConstraint(['table_id'], ['visualization.table.id'], name=op.f(
                        'fk_result_table_table_id_table')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_result_table')),
                    schema='analysis'
                    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('result_table', schema='analysis')
    op.drop_table('result_image', schema='analysis')
    op.drop_table('result_echart', schema='analysis')
    op.drop_table('code_output', schema='analysis')
    op.drop_table('time_series', schema='data_objects')
    op.drop_table('tabular', schema='data_objects')
    op.drop_table('markdown_cell', schema='analysis')
    op.drop_table('code_cell', schema='analysis')
    op.drop_table('pipeline_run_output_model_entity', schema='entity_graph')
    op.drop_table('pipeline_run_output_dataset', schema='entity_graph')
    op.drop_table('pipeline_run_output_data_source', schema='entity_graph')
    op.drop_table('model_instantiated_supported_in_pipeline',
                  schema='entity_graph')
    op.drop_table('model_instantiated_in_pipeline_run', schema='entity_graph')
    op.drop_table('model_instantiated_in_analysis', schema='entity_graph')
    op.drop_table('dataset_in_pipeline_run', schema='entity_graph')
    op.drop_table('data_source_in_pipeline_run', schema='entity_graph')
    op.drop_table('time_series_group', schema='data_objects')
    op.drop_table('tabular_group', schema='data_objects')
    op.drop_table('data_object', schema='data_objects')
    op.drop_table('analysis_cell', schema='analysis')
    op.drop_table('pipeline_run', schema='pipeline')
    op.drop_table('pipeline_implementation', schema='pipeline')
    op.drop_table('model_instantiated', schema='model')
    op.drop_table('model_implementation', schema='model')
    op.drop_table('swe_run', schema='kvasir_v1')
    op.drop_table('swe_deps', schema='kvasir_v1')
    op.drop_table('results_queue', schema='kvasir_v1')
    op.drop_table('result', schema='kvasir_v1')
    op.drop_table('pydantic_ai_message', schema='kvasir_v1')
    op.drop_table('message', schema='kvasir_v1')
    op.drop_table('analysis_run', schema='kvasir_v1')
    op.drop_table('dataset_supported_in_pipeline', schema='entity_graph')
    op.drop_table('dataset_in_analysis', schema='entity_graph')
    op.drop_table('dataset_from_data_source', schema='entity_graph')
    op.drop_table('data_source_supported_in_pipeline', schema='entity_graph')
    op.drop_table('data_source_in_analysis', schema='entity_graph')
    op.drop_table('file_data_source', schema='data_sources')
    op.drop_table('object_group', schema='data_objects')
    op.drop_table('analysis_section', schema='analysis')
    op.drop_table('project', schema='project')
    op.drop_table('pipeline', schema='pipeline')
    op.drop_table('model', schema='model')
    op.drop_table('run', schema='kvasir_v1')
    op.drop_table('node_in_group', schema='entity_graph')
    op.drop_table('data_source', schema='data_sources')
    op.drop_table('dataset', schema='data_objects')
    op.drop_table('user_api_keys', schema='auth')
    op.drop_table('analysis', schema='analysis')
    op.drop_table('waitlist', schema='waitlist')
    op.drop_table('table', schema='visualization')
    op.drop_table('image', schema='visualization')
    op.drop_table('echart', schema='visualization')
    op.drop_table('model_function', schema='model')
    op.drop_table('node_group', schema='entity_graph')
    op.drop_table('entity_node', schema='entity_graph')
    op.drop_table('users', schema='auth')
    # ### end Alembic commands ###
