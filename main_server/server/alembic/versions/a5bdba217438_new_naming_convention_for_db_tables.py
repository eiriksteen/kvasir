"""new naming convention for db tables

Revision ID: a5bdba217438
Revises: 17279cc1e512
Create Date: 2025-10-10 04:36:33.210924

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'a5bdba217438'
down_revision: Union[str, None] = '17279cc1e512'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('notebook',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_notebook')),
    schema='analysis'
    )
    op.create_table('notebook_section',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('notebook_id', sa.UUID(), nullable=False),
    sa.Column('section_name', sa.String(), nullable=False),
    sa.Column('section_description', sa.String(), nullable=True),
    sa.Column('next_type', sa.String(), nullable=True),
    sa.Column('next_id', sa.UUID(), nullable=True),
    sa.Column('parent_section_id', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['notebook_id'], ['analysis.notebook.id'], name=op.f('fk_notebook_section_notebook_id_notebook')),
    sa.ForeignKeyConstraint(['parent_section_id'], ['analysis.notebook_section.id'], name=op.f('fk_notebook_section_parent_section_id_notebook_section')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_notebook_section')),
    schema='analysis'
    )
    op.create_table('analysis_object',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('report_generated', sa.Boolean(), nullable=False),
    sa.Column('notebook_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_analysis_object_project_id_project')),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_analysis_object_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_object')),
    schema='analysis'
    )
    op.create_table('analysis_result',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis', sa.String(), nullable=False),
    sa.Column('python_code', sa.String(), nullable=True),
    sa.Column('output_variable', sa.String(), nullable=True),
    sa.Column('input_variable', sa.String(), nullable=True),
    sa.Column('section_id', sa.UUID(), nullable=True),
    sa.Column('next_type', sa.String(), nullable=True),
    sa.Column('next_id', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['section_id'], ['analysis.notebook_section.id'], name=op.f('fk_analysis_result_section_id_notebook_section')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_result')),
    schema='analysis'
    )
    op.create_table('analysis_objects_dataset',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_object_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_object_id'], ['analysis.analysis_object.id'], name=op.f('fk_analysis_objects_dataset_analysis_object_id_analysis_object')),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_analysis_objects_dataset_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_objects_dataset')),
    schema='analysis'
    )
    op.create_table('analysis_result_data_source',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('data_source_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_result.id'], name=op.f('fk_analysis_result_data_source_analysis_result_id_analysis_result')),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_analysis_result_data_source_data_source_id_data_source')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_result_data_source')),
    schema='analysis'
    )
    op.create_table('analysis_results_dataset',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('dataset_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_result.id'], name=op.f('fk_analysis_results_dataset_analysis_result_id_analysis_result')),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_analysis_results_dataset_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_results_dataset')),
    schema='analysis'
    )
    op.create_table('plot',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('plot_config', sa.JSON(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_result.id'], name=op.f('fk_plot_analysis_result_id_analysis_result')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_plot')),
    schema='plots'
    )
    op.create_table('table',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('table_config', sa.JSON(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_result.id'], name=op.f('fk_table_analysis_result_id_analysis_result')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_table')),
    schema='tables'
    )
    op.create_table('analysis_result_run',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_result.id'], name=op.f('fk_analysis_result_run_analysis_result_id_analysis_result')),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_analysis_result_run_run_id_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_result_run')),
    schema='analysis'
    )
    op.create_table('analysis_status_message',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('run_id', sa.UUID(), nullable=False),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('message', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_result.id'], name=op.f('fk_analysis_status_message_analysis_result_id_analysis_result')),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_analysis_status_message_run_id_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_status_message')),
    schema='analysis'
    )
    op.drop_constraint(op.f('fk_aggregation_object_analysis_result_id_analysis_results'), 'aggregation_object', schema='data_objects', type_='foreignkey')
    op.drop_constraint(op.f('fk_analysis_node_analysis_id_analysis_objects'), 'analysis_node', schema='node', type_='foreignkey')
    op.drop_constraint(op.f('fk_analysis_context_analysis_id_analysis_objects'), 'analysis_context', schema='orchestrator', type_='foreignkey')
    op.drop_constraint(op.f('fk_project_analysis_analysis_id_analysis_objects'), 'project_analysis', schema='project', type_='foreignkey')


    op.drop_table('plots', schema='plots')
    op.drop_table('tables', schema='tables')
    op.drop_table('analysis_results_data_sources', schema='analysis')
    op.drop_table('analysis_results_datasets', schema='analysis')
    op.drop_table('analysis_objects_datasets', schema='analysis')
    op.drop_table('analysis_status_messages', schema='analysis')
    op.drop_table('analysis_result_runs', schema='analysis')
    op.drop_table('analysis_results', schema='analysis')
    op.drop_table('notebook_sections', schema='analysis')
    op.drop_table('notebooks', schema='analysis')
    op.drop_table('analysis_objects', schema='analysis')
    op.create_foreign_key(op.f('fk_aggregation_object_analysis_result_id_analysis_result'), 'aggregation_object', 'analysis_result', ['analysis_result_id'], ['id'], source_schema='data_objects', referent_schema='analysis')
    
    op.create_foreign_key(op.f('fk_analysis_node_analysis_id_analysis_object'), 'analysis_node', 'analysis_object', ['analysis_id'], ['id'], source_schema='node', referent_schema='analysis')
    op.create_foreign_key(op.f('fk_analysis_context_analysis_id_analysis_object'), 'analysis_context', 'analysis_object', ['analysis_id'], ['id'], source_schema='orchestrator', referent_schema='analysis')
    op.create_foreign_key(op.f('fk_project_analysis_analysis_id_analysis_object'), 'project_analysis', 'analysis_object', ['analysis_id'], ['id'], source_schema='project', referent_schema='analysis')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(op.f('fk_project_analysis_analysis_id_analysis_object'), 'project_analysis', schema='project', type_='foreignkey')
    op.create_foreign_key(op.f('fk_project_analysis_analysis_id_analysis_objects'), 'project_analysis', 'analysis_objects', ['analysis_id'], ['id'], source_schema='project', referent_schema='analysis')
    op.drop_constraint(op.f('fk_analysis_context_analysis_id_analysis_object'), 'analysis_context', schema='orchestrator', type_='foreignkey')
    op.create_foreign_key(op.f('fk_analysis_context_analysis_id_analysis_objects'), 'analysis_context', 'analysis_objects', ['analysis_id'], ['id'], source_schema='orchestrator', referent_schema='analysis')
    op.drop_constraint(op.f('fk_analysis_node_analysis_id_analysis_object'), 'analysis_node', schema='node', type_='foreignkey')
    op.create_foreign_key(op.f('fk_analysis_node_analysis_id_analysis_objects'), 'analysis_node', 'analysis_objects', ['analysis_id'], ['id'], source_schema='node', referent_schema='analysis')
    op.drop_constraint(op.f('fk_aggregation_object_analysis_result_id_analysis_result'), 'aggregation_object', schema='data_objects', type_='foreignkey')
    op.create_foreign_key(op.f('fk_aggregation_object_analysis_result_id_analysis_results'), 'aggregation_object', 'analysis_results', ['analysis_result_id'], ['id'], source_schema='data_objects', referent_schema='analysis')
    op.create_table('analysis_results',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('analysis', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('python_code', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('output_variable', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('input_variable', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('section_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('next_type', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('next_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['section_id'], ['analysis.notebook_sections.id'], name='fk_analysis_results_section_id_notebook_sections'),
    sa.PrimaryKeyConstraint('id', name='pk_analysis_results'),
    schema='analysis',
    postgresql_ignore_search_path=False
    )
    op.create_table('analysis_results_data_sources',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('data_source_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_analysis_results_data_sources_analysis_result_id_ana_7560')),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f('fk_analysis_results_data_sources_data_source_id_data_source')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_results_data_sources')),
    schema='analysis'
    )
    op.create_table('analysis_results_datasets',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('dataset_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_analysis_results_datasets_analysis_result_id_analysi_9b86')),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_analysis_results_datasets_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_results_datasets')),
    schema='analysis'
    )
    op.create_table('analysis_objects_datasets',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('analysis_object_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('dataset_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['analysis_object_id'], ['analysis.analysis_objects.id'], name=op.f('fk_analysis_objects_datasets_analysis_object_id_analysi_8693')),
    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f('fk_analysis_objects_datasets_dataset_id_dataset')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_objects_datasets')),
    schema='analysis'
    )
    op.create_table('analysis_result_runs',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('run_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_analysis_result_runs_analysis_result_id_analysis_results')),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_analysis_result_runs_run_id_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_result_runs')),
    schema='analysis'
    )
    op.create_table('plots',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('plot_config', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_plots_analysis_result_id_analysis_results')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_plots')),
    schema='plots'
    )
    op.create_table('analysis_status_messages',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('run_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('message', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_analysis_status_messages_analysis_result_id_analysis_results')),
    sa.ForeignKeyConstraint(['run_id'], ['runs.run.id'], name=op.f('fk_analysis_status_messages_run_id_run')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_status_messages')),
    schema='analysis'
    )
    op.create_table('notebook_sections',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('notebook_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('section_name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('section_description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('next_type', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('next_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('parent_section_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['notebook_id'], ['analysis.notebooks.id'], name='fk_notebook_sections_notebook_id_notebooks'),
    sa.ForeignKeyConstraint(['parent_section_id'], ['analysis.notebook_sections.id'], name='fk_notebook_sections_parent_section_id_notebook_sections'),
    sa.PrimaryKeyConstraint('id', name='pk_notebook_sections'),
    schema='analysis',
    postgresql_ignore_search_path=False
    )
    op.create_table('tables',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('analysis_result_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('table_config', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['analysis_result_id'], ['analysis.analysis_results.id'], name=op.f('fk_tables_analysis_result_id_analysis_results')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_tables')),
    schema='tables'
    )
    op.create_table('analysis_objects',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('project_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('report_generated', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('notebook_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['project.project.id'], name=op.f('fk_analysis_objects_project_id_project')),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name=op.f('fk_analysis_objects_user_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_analysis_objects')),
    schema='analysis'
    )
    op.create_table('notebooks',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_notebooks')),
    schema='analysis'
    )
    op.drop_table('analysis_status_message', schema='analysis')
    op.drop_table('analysis_result_run', schema='analysis')
    op.drop_table('table', schema='tables')
    op.drop_table('plot', schema='plots')
    op.drop_table('analysis_results_dataset', schema='analysis')
    op.drop_table('analysis_result_data_source', schema='analysis')
    op.drop_table('analysis_objects_dataset', schema='analysis')
    op.drop_table('analysis_result', schema='analysis')
    op.drop_table('analysis_object', schema='analysis')
    op.drop_table('notebook_section', schema='analysis')
    op.drop_table('notebook', schema='analysis')
    # ### end Alembic commands ###
