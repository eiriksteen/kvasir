"""Add entity graph

Revision ID: 40fad3625239
Revises: 4e0240c8c8a4
Create Date: 2025-11-02 23:10:11.133210

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '40fad3625239'
down_revision: Union[str, None] = '4e0240c8c8a4'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    # Create entity_graph schema
    op.execute('CREATE SCHEMA IF NOT EXISTS entity_graph')

    op.create_table('analysis_from_past_analysis',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('past_analysis_id', sa.UUID(), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_analysis_from_past_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['past_analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_analysis_from_past_analysis_past_analysis_id_analysis')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pk_analysis_from_past_analysis')),
                    schema='entity_graph'
                    )
    op.create_table('data_source_from_pipeline',
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_from_pipeline_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_data_source_from_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('data_source_id', 'pipeline_id', name=op.f(
                        'pk_data_source_from_pipeline')),
                    schema='entity_graph'
                    )
    op.create_table('data_source_in_analysis',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_data_source_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_in_analysis_data_source_id_data_source')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pk_data_source_in_analysis')),
                    schema='entity_graph'
                    )
    op.create_table('data_source_supported_in_pipeline',
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_supported_in_pipeline_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_data_source_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('data_source_id', 'pipeline_id', name=op.f(
                        'pk_data_source_supported_in_pipeline')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_from_data_source',
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_dataset_from_data_source_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_from_data_source_dataset_id_dataset')),
                    sa.PrimaryKeyConstraint('data_source_id', 'dataset_id', name=op.f(
                        'pk_dataset_from_data_source')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_in_analysis',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_dataset_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_in_analysis_dataset_id_dataset')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_dataset_in_analysis')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_supported_in_pipeline',
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_supported_in_pipeline_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_dataset_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('dataset_id', 'pipeline_id', name=op.f(
                        'pk_dataset_supported_in_pipeline')),
                    schema='entity_graph'
                    )
    op.create_table('model_instantiated_in_analysis',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('analysis_id', sa.UUID(), nullable=False),
                    sa.Column('model_instantiated_id',
                              sa.UUID(), nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_model_entity_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_entity_in_analysis_model_entity_id_model_entity')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pk_model_entity_in_analysis')),
                    schema='entity_graph'
                    )
    op.create_table('model_instantiated_supported_in_pipeline',
                    sa.Column('model_instantiated_id',
                              sa.UUID(), nullable=False),
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_entity_supported_in_pipeline_model_entity_id_model_entity')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_model_entity_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('model_instantiated_id', 'pipeline_id', name=op.f(
                        'pk_model_entity_supported_in_pipeline')),
                    schema='entity_graph'
                    )
    op.create_table('data_source_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_in_pipeline_run_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_data_source_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'data_source_id', name=op.f(
                        'pk_data_source_in_pipeline_run')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_from_pipeline',
                    sa.Column('pipeline_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=True),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_from_pipeline_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_dataset_from_pipeline_pipeline_id_pipeline')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_dataset_from_pipeline_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint(
                        'pipeline_id', 'dataset_id', name=op.f('pk_dataset_from_pipeline')),
                    schema='entity_graph'
                    )
    op.create_table('dataset_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_in_pipeline_run_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_dataset_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'dataset_id', name=op.f(
                        'pk_dataset_in_pipeline_run')),
                    schema='entity_graph'
                    )
    op.create_table('model_instantiated_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('model_instantiated_id',
                              sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_entity_in_pipeline_run_model_entity_id_model_entity')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_model_entity_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'model_instantiated_id', name=op.f(
                        'pk_model_entity_in_pipeline_run')),
                    schema='entity_graph'
                    )
    op.create_table('pipeline_run_output_data_source',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('data_source_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_pipeline_run_output_data_source_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_data_source_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'data_source_id', name=op.f(
                        'pk_pipeline_run_output_data_source')),
                    schema='entity_graph'
                    )
    op.create_table('pipeline_run_output_dataset',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('dataset_id', sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_pipeline_run_output_dataset_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_dataset_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'dataset_id', name=op.f(
                        'pk_pipeline_run_output_dataset')),
                    schema='entity_graph'
                    )
    op.create_table('pipeline_run_output_model_entity',
                    sa.Column('pipeline_run_id', sa.UUID(), nullable=False),
                    sa.Column('model_instantiated_id',
                              sa.UUID(), nullable=False),
                    sa.Column('created_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.Column('updated_at', sa.DateTime(
                        timezone=True), nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_pipeline_run_output_model_entity_model_entity_id_model_entity')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_model_entity_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'model_instantiated_id', name=op.f(
                        'pk_pipeline_run_output_model_entity')),
                    schema='entity_graph'
                    )
    op.drop_table('pipeline_run_output_dataset', schema='pipeline')
    op.drop_table('data_source_in_analysis', schema='analysis')
    op.drop_table('analysis_from_past_analysis', schema='analysis')
    op.drop_table('data_source_supported_in_pipeline', schema='pipeline')
    op.drop_table('pipeline_run_output_model_entity', schema='pipeline')
    op.drop_table('dataset_from_data_source', schema='data_objects')
    op.drop_table('data_source_in_pipeline_run', schema='pipeline')
    op.drop_table('dataset_in_analysis', schema='analysis')
    op.drop_table('dataset_supported_in_pipeline', schema='pipeline')
    op.drop_table('model_instantiated_in_analysis', schema='analysis')
    op.drop_table('pipeline_run_output_data_source', schema='pipeline')
    op.drop_table('dataset_from_pipeline', schema='data_objects')
    op.drop_table('model_instantiated_supported_in_pipeline',
                  schema='pipeline')
    op.drop_table('model_instantiated_in_pipeline_run', schema='pipeline')
    op.drop_table('dataset_in_pipeline_run', schema='pipeline')
    op.drop_table('data_source_from_pipeline', schema='data_sources')
    op.add_column('data_source', sa.Column(
        'description', sa.String(), nullable=False), schema='data_sources')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column('data_source', 'description', schema='data_sources')
    op.create_table('data_source_from_pipeline',
                    sa.Column('data_source_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('pipeline_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_from_pipeline_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_data_source_from_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('data_source_id', 'pipeline_id', name=op.f(
                        'pk_data_source_from_pipeline')),
                    schema='data_sources'
                    )
    op.create_table('dataset_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_in_pipeline_run_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_dataset_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'dataset_id', name=op.f(
                        'pk_dataset_in_pipeline_run')),
                    schema='pipeline'
                    )
    op.create_table('model_instantiated_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('model_instantiated_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_entity_in_pipeline_run_model_entity_id_model_entity')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_model_entity_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'model_instantiated_id', name=op.f(
                        'pk_model_entity_in_pipeline_run')),
                    schema='pipeline'
                    )
    op.create_table('model_instantiated_supported_in_pipeline',
                    sa.Column('model_instantiated_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('pipeline_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_entity_supported_in_pipeline_model_entity_id_m_257d')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_model_entity_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('model_instantiated_id', 'pipeline_id', name=op.f(
                        'pk_model_entity_supported_in_pipeline')),
                    schema='pipeline'
                    )
    op.create_table('dataset_from_pipeline',
                    sa.Column('pipeline_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=True),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_from_pipeline_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_dataset_from_pipeline_pipeline_id_pipeline')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_dataset_from_pipeline_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint(
                        'pipeline_id', 'dataset_id', name=op.f('pk_dataset_from_pipeline')),
                    schema='data_objects'
                    )
    op.create_table('pipeline_run_output_data_source',
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('data_source_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_pipeline_run_output_data_source_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_data_source_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'data_source_id', name=op.f(
                        'pk_pipeline_run_output_data_source')),
                    schema='pipeline'
                    )
    op.create_table('model_instantiated_in_analysis',
                    sa.Column('id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('model_instantiated_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('analysis_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_model_entity_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_model_entity_in_analysis_model_entity_id_model_entity')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pk_model_entity_in_analysis')),
                    schema='analysis'
                    )
    op.create_table('dataset_supported_in_pipeline',
                    sa.Column('dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('pipeline_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_supported_in_pipeline_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_dataset_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('dataset_id', 'pipeline_id', name=op.f(
                        'pk_dataset_supported_in_pipeline')),
                    schema='pipeline'
                    )
    op.create_table('dataset_in_analysis',
                    sa.Column('id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('analysis_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_dataset_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_in_analysis_dataset_id_dataset')),
                    sa.PrimaryKeyConstraint(
                        'id', name=op.f('pk_dataset_in_analysis')),
                    schema='analysis'
                    )
    op.create_table('data_source_in_pipeline_run',
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('data_source_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_in_pipeline_run_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_data_source_in_pipeline_run_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'data_source_id', name=op.f(
                        'pk_data_source_in_pipeline_run')),
                    schema='pipeline'
                    )
    op.create_table('dataset_from_data_source',
                    sa.Column('data_source_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_dataset_from_data_source_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_dataset_from_data_source_dataset_id_dataset')),
                    sa.PrimaryKeyConstraint('data_source_id', 'dataset_id', name=op.f(
                        'pk_dataset_from_data_source')),
                    schema='data_objects'
                    )
    op.create_table('pipeline_run_output_model_entity',
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('model_instantiated_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['model_instantiated_id'], ['model.model_instantiated.id'], name=op.f(
                        'fk_pipeline_run_output_model_entity_model_entity_id_mod_62ab')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_model_entity_pipeline_run_id_pip_a666')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'model_instantiated_id', name=op.f(
                        'pk_pipeline_run_output_model_entity')),
                    schema='pipeline'
                    )
    op.create_table('data_source_supported_in_pipeline',
                    sa.Column('data_source_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('pipeline_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_supported_in_pipeline_data_source_id_data_source')),
                    sa.ForeignKeyConstraint(['pipeline_id'], ['pipeline.pipeline.id'], name=op.f(
                        'fk_data_source_supported_in_pipeline_pipeline_id_pipeline')),
                    sa.PrimaryKeyConstraint('data_source_id', 'pipeline_id', name=op.f(
                        'pk_data_source_supported_in_pipeline')),
                    schema='pipeline'
                    )
    op.create_table('analysis_from_past_analysis',
                    sa.Column('id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('analysis_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('past_analysis_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_analysis_from_past_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['past_analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_analysis_from_past_analysis_past_analysis_id_analysis')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pk_analysis_from_past_analysis')),
                    schema='analysis'
                    )
    op.create_table('data_source_in_analysis',
                    sa.Column('id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('data_source_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('analysis_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['analysis_id'], ['analysis.analysis.id'], name=op.f(
                        'fk_data_source_in_analysis_analysis_id_analysis')),
                    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.data_source.id'], name=op.f(
                        'fk_data_source_in_analysis_data_source_id_data_source')),
                    sa.PrimaryKeyConstraint('id', name=op.f(
                        'pk_data_source_in_analysis')),
                    schema='analysis'
                    )
    op.create_table('pipeline_run_output_dataset',
                    sa.Column('pipeline_run_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('dataset_id', sa.UUID(),
                              autoincrement=False, nullable=False),
                    sa.Column('created_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.Column('updated_at', postgresql.TIMESTAMP(
                        timezone=True), autoincrement=False, nullable=False),
                    sa.ForeignKeyConstraint(['dataset_id'], ['data_objects.dataset.id'], name=op.f(
                        'fk_pipeline_run_output_dataset_dataset_id_dataset')),
                    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline.pipeline_run.id'], name=op.f(
                        'fk_pipeline_run_output_dataset_pipeline_run_id_pipeline_run')),
                    sa.PrimaryKeyConstraint('pipeline_run_id', 'dataset_id', name=op.f(
                        'pk_pipeline_run_output_dataset')),
                    schema='pipeline'
                    )
    op.drop_table('pipeline_run_output_model_entity', schema='entity_graph')
    op.drop_table('pipeline_run_output_dataset', schema='entity_graph')
    op.drop_table('pipeline_run_output_data_source', schema='entity_graph')
    op.drop_table('model_instantiated_in_pipeline_run', schema='entity_graph')
    op.drop_table('dataset_in_pipeline_run', schema='entity_graph')
    op.drop_table('dataset_from_pipeline', schema='entity_graph')
    op.drop_table('data_source_in_pipeline_run', schema='entity_graph')
    op.drop_table('model_instantiated_supported_in_pipeline',
                  schema='entity_graph')
    op.drop_table('model_instantiated_in_analysis', schema='entity_graph')
    op.drop_table('dataset_supported_in_pipeline', schema='entity_graph')
    op.drop_table('dataset_in_analysis', schema='entity_graph')
    op.drop_table('dataset_from_data_source', schema='entity_graph')
    op.drop_table('data_source_supported_in_pipeline', schema='entity_graph')
    op.drop_table('data_source_in_analysis', schema='entity_graph')
    op.drop_table('data_source_from_pipeline', schema='entity_graph')
    op.drop_table('analysis_from_past_analysis', schema='entity_graph')

    # Drop entity_graph schema
    op.execute('DROP SCHEMA IF EXISTS entity_graph CASCADE')
    # ### end Alembic commands ###
